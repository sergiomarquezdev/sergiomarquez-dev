---
interface NavItem {
	id: string;
	label: string;
}

const navItems: NavItem[] = [
	{ id: "about", label: "About" },
	{ id: "experience", label: "Experience" },
	{ id: "projects", label: "Projects" },
	{ id: "certifications", label: "Certifications" },
];
---

<nav class="navigation" aria-label="Main navigation">
  <ul class="nav-list">
    {navItems.map((item) => (
      <li>
        <a href={`#${item.id}`} class="nav-link" data-section={item.id}>
          <span class="nav-indicator" />
          <span class="nav-text">{item.label}</span>
        </a>
      </li>
    ))}
  </ul>
</nav>

<script>
  function initNavigation() {
    const navLinks = document.querySelectorAll<HTMLAnchorElement>('.nav-link');
    const sections = document.querySelectorAll<HTMLElement>('section[id]');

    if (navLinks.length === 0 || sections.length === 0) return;

    const observerOptions: IntersectionObserverInit = {
      rootMargin: '-50% 0px -50% 0px',
      threshold: 0
    };

    function setActiveLink(sectionId: string) {
      navLinks.forEach(link => {
        const isActive = link.dataset.section === sectionId;
        link.classList.toggle('active', isActive);
      });
    }

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          setActiveLink(entry.target.id);
        }
      });
    }, observerOptions);

    sections.forEach(section => observer.observe(section));

    // Set initial active state
    const hash = window.location.hash.slice(1);
    if (hash && document.getElementById(hash)) {
      setActiveLink(hash);
    } else if (sections[0]) {
      setActiveLink(sections[0].id);
    }
  }

  // Run on initial load and after view transitions
  document.addEventListener('astro:page-load', initNavigation);
  initNavigation();
</script>

<style>
  .navigation {
    display: none;
  }

  @media (min-width: 1024px) {
    .navigation {
      display: block;
    }
  }

  .nav-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .nav-link {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 0.25rem 0;
    color: var(--secondary-text);
    font-size: 0.75rem;
    font-weight: 600;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    transition: color 0.2s ease-in-out;
  }

  .nav-link:hover {
    color: var(--primary-text);
  }

  .nav-link:hover .nav-indicator {
    width: 4rem;
    background-color: var(--primary-text);
  }

  .nav-link.active {
    color: var(--accent);
  }

  .nav-link.active .nav-indicator {
    width: 4rem;
    background-color: var(--accent);
  }

  .nav-indicator {
    width: 2rem;
    height: 1px;
    background-color: var(--tertiary-text);
    transition: width 0.2s ease-in-out, background-color 0.2s ease-in-out;
  }

  .nav-text {
    transition: transform 0.2s ease-in-out;
  }

  .nav-link:hover .nav-text {
    transform: translateX(4px);
  }

  .nav-link.active .nav-text {
    transform: translateX(4px);
  }
</style>
